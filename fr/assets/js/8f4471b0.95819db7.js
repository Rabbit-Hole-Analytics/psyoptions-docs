(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{145:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/initialize_market_page-856da4b58eade2e35e691ca0804c7f2a.png"},82:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return c})),n.d(t,"default",(function(){return p}));var o=n(3),r=n(7),a=(n(0),n(96)),i={id:"american-how-it-works",title:"American Protocol V1 How It Works",sidebar_label:"How It Works",slug:"/american-v1/how-it-works"},s={unversionedId:"american-how-it-works",id:"american-how-it-works",isDocsHomePage:!1,title:"American Protocol V1 How It Works",description:"To truly understand how the protocol and platform works, one needs to understand what's happening under the hood. Here we will do our best to break down each interaction an entity may make with the protocol and what's happening.",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/how-it-works.md",slug:"/american-v1/how-it-works",permalink:"/fr/american-v1/how-it-works",editUrl:"https://github.com/mithraiclabs/psyoptions-docs/tree/master/docs/how-it-works.md",version:"current",sidebar_label:"How It Works",sidebar:"someSidebar",previous:{title:"Call vs Put",permalink:"/fr/architecture/call-put"},next:{title:"Program Integration",permalink:"/fr/program-integration/quick-start"}},c=[{value:"Initialize new options market",id:"initialize-new-options-market",children:[]},{value:"Minting an option",id:"minting-an-option",children:[]},{value:"Exercising a contract",id:"exercising-a-contract",children:[]},{value:"Extracting assets from an exercised contract",id:"extracting-assets-from-an-exercised-contract",children:[]},{value:"Getting your underlying back after expiration",id:"getting-your-underlying-back-after-expiration",children:[]},{value:"Closing a position pre-expiration",id:"closing-a-position-pre-expiration",children:[]}],l={toc:c};function p(e){var t=e.components,i=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},l,i,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"To truly understand how the protocol and platform works, one needs to understand what's happening under the hood. Here we will do our best to break down each interaction an entity may make with the protocol and what's happening."),Object(a.b)("h2",{id:"initialize-new-options-market"},"Initialize new options market"),Object(a.b)("p",null,Object(a.b)("img",{alt:"initialize market",src:n(145).default})),Object(a.b)("p",null,"The protocol is designed to be a primitive, so it makes very little assumptions about options, how they should be traded, priced, etc. The protocol itself, also makes no assumptions on what assets should have options and which should not. It has been built with various use cases in mind, like writing contracts on NFTs, tokenized property deeds, tokenized stocks...anything that can be represented as an SPL Token can have an option market. Will there be liquidity on those markets is a topic for another discussion ;)."),Object(a.b)("p",null,"Option markets themselves are completely open and permissionless. If there are a pair of assets you want to write options one, you can create that market! To do so you need to use the ",Object(a.b)("inlineCode",{parentName:"p"},"InitializeMarket")," instruction. Each market is goverened by specific parameters that determine its fungibility. Those parameters include:"),Object(a.b)("pre",null,Object(a.b)("code",{parentName:"pre",className:"language-Rust"},"pub struct OptionMarket {\n  ...\n    /// The SPL Token Address that is held in the program's pool when an option is written\n    pub underlying_asset_mint: Pubkey,\n    /// The SPL Token Address that denominates the strike price\n    pub quote_asset_mint: Pubkey,\n    /// The amount of the **underlying asset** that derives a single option\n    pub underlying_amount_per_contract: u64,\n    /// The amount of **quote asset** that must be transfered when an option is exercised\n    pub quote_amount_per_contract: u64,\n    /// The Unix timestamp **in seconds** at which the contracts in this market expire\n    pub expiration_unix_timestamp: UnixTimestamp,\n  ...\n}\n")),Object(a.b)("p",null,"It is important to note that the protocol uses deterministic addressing of markets, based on the unique parameters, so there can never be two of the exact same market. This was a concious decision of V1 to reduce the chance of fragmented liquidity."),Object(a.b)("p",null,"Creating a new market is extremely cheap and easy! When a new market is initialized a few things happen. The most important are the creation of the ",Object(a.b)("strong",{parentName:"p"},"Underlying Asset Pool")," and the ",Object(a.b)("strong",{parentName:"p"},"Quote Asset Pool")," for that market. These pools are unique to and owned by each individual market. When someone mints an option contract, their collateral is stored in these pools, more on that next."),Object(a.b)("h2",{id:"minting-an-option"},"Minting an option"),Object(a.b)("p",null,"Without a doubt, the most important and widely used instruction of the protocol. When you want to mint a contract for a given market you need the ",Object(a.b)("inlineCode",{parentName:"p"},"MintCoveredCall")," instruction. It is ",Object(a.b)("strong",{parentName:"p"},"extremely important to note")," that although this instruction contains the phrase ",Object(a.b)("em",{parentName:"p"},"Covered Call")," in the V1 protocol, all contracts can be considered covered calls. PUTs are simply the reciprical of the a CALL, and all of V1's markets require 100% collateral upfront. More can be read ",Object(a.b)("a",{parentName:"p",href:"/fr/architecture/call-put"},"here"),"."),Object(a.b)("p",null,"To mint a contract, the contract writer must put up 100% of the ",Object(a.b)("inlineCode",{parentName:"p"},"underlying_amount_per_contract")," plus a 5bps minting fee. This small fee will got to the PsyOptions treasury and will be adjustable (or removable) via governance. So the total underlying assets required to mint 1 contract is:"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"underlying_assets_required = underlying_amount_per_contract + (underlying_amount_per_contract * 0.0005)")),Object(a.b)("p",null,"These unserlying assets are then stored in the option markets' ",Object(a.b)("em",{parentName:"p"},"Underlying Asset Pool"),". If the transfer to the pool succeeds (i.e. enough underlying was posted), then the protocol mints the user 2 tokens, the ",Object(a.b)("strong",{parentName:"p"},"OptionToken")," and the ",Object(a.b)("strong",{parentName:"p"},"WriterToken"),"."),Object(a.b)("p",null,"The ",Object(a.b)("strong",{parentName:"p"},"OptionToken is the actual contract"),", which gives the holder ",Object(a.b)("em",{parentName:"p"},"the right but not the obligation to swap the quote assets for the underlying assets at the agreed upon strike price"),". The OptionToken is an SPL Token, so it can be transfered or traded on any venue that has SPL Token support."),Object(a.b)("p",null,"The ",Object(a.b)("strong",{parentName:"p"},"WriterToken")," denotes the holder is short the option or wrote the contract. Lets break that statement down into more logical terms. Given this is an American style contract the OptionToken holder can exercise at any point in time prior to expiration. So at any point (pre or post expiration) the WriterToken gives the holder the ability to claim the ",Object(a.b)("inlineCode",{parentName:"p"},"quote_amount_per_contract")," should anyone exercise and the Quote Asset Pool contains enough of a balance. Post expiration, the WriterToken gives the holder the ability to claim the ",Object(a.b)("inlineCode",{parentName:"p"},"underlying_amount_per_contract")," back from the Underlying Asset Pool."),Object(a.b)("p",null,"So to generate yield from writing a contract, you would sell the OptionToken. That could be done OTC and transfered, on a Seurm market, or any other venue that creates and exchange for a market's SPLs."),Object(a.b)("h2",{id:"exercising-a-contract"},"Exercising a contract"),Object(a.b)("p",null,"With the OptionToken we have the ability to exercise the contract with the use of the ",Object(a.b)("inlineCode",{parentName:"p"},"ExerciseCoveredCall")," instruction. To exercise we must post the OptionToken held and the ",Object(a.b)("inlineCode",{parentName:"p"},"quote_amount_per_contract")," plus a 5bps fee. This small fee will got to the PsyOptions treasury and will be adjustable (or removable) via governance. So the total quote asset that must be posted is"),Object(a.b)("p",null,Object(a.b)("inlineCode",{parentName:"p"},"quote_assets_required = quote_amount_per_contract + (quote_amount_per_contract * 0.0005)")),Object(a.b)("p",null,"With the correct amount posted, the protocol burns the OptionToken, transfers ",Object(a.b)("inlineCode",{parentName:"p"},"quote_amount_per_contract")," to the market's Quote Asset Pool, and transfers ",Object(a.b)("inlineCode",{parentName:"p"},"underlying_amount_per_contract")," to the exerciser's address."),Object(a.b)("p",null,"Now that someone has exercised, we'll cover how a contract writer can claim those assets."),Object(a.b)("h2",{id:"extracting-assets-from-an-exercised-contract"},"Extracting assets from an exercised contract"),Object(a.b)("p",null,"Economic theories have proven that it is not beneficial to exercise a contract early. But this is not TradFi. The composability of PsyOptions American V1 provides many use cases outside of pure volatility trading, portfolio hedging, etc. where exercising early will most certainly happen. Lets take protocol XYZ that is running a liquidity mining program that incentivized new liquidity providers with At The Money (ATM) contracts that expire in 10 years. As long as project XYZ continues to grow, these contract holders will most cetainly exercise early."),Object(a.b)("p",null,"Now when that early exercise occurs, the contract writer is able to claim the quote assets as soon as they are available. To do so, the contract writer must use the ",Object(a.b)("inlineCode",{parentName:"p"},"ExchangeWriterTokenForQuote")," instruction. The user most post the WriterToken. The protocol will burn the WriterToken and transfer the ",Object(a.b)("inlineCode",{parentName:"p"},"quote_amount_per_contract")," to the writer's wallet."),Object(a.b)("p",null,"A few items to note. First, this instruction can be called at any point in time, so long as there are enough quote assets in the Quote Asset Pool. Second, this instruction acts on a ",Object(a.b)("strong",{parentName:"p"},"first come, first serve basis"),". All OptionTokens and WriterTokens for a given market are respectively fungible (i.e. Any OptionToken is the same as another for the given market. The same is true for the WriterToken.). So as soon as someone exercises an OptionContract ",Object(a.b)("strong",{parentName:"p"},"anyone holding a WriterToken for that market has a claim on the quote assets"),"."),Object(a.b)("h2",{id:"getting-your-underlying-back-after-expiration"},"Getting your underlying back after expiration"),Object(a.b)("p",null,"After expiration, a contract writer has a claim on their original underlying assets that they posted to write the contract. ",Object(a.b)("strong",{parentName:"p"},"Only after expiration")," can a WriterToken sent the protocol to be burned in exchange for the ",Object(a.b)("inlineCode",{parentName:"p"},"underlying_amount_per_contract"),". This is done through the ",Object(a.b)("inlineCode",{parentName:"p"},"ClosePostExpiration")," instruction."),Object(a.b)("h2",{id:"closing-a-position-pre-expiration"},"Closing a position pre-expiration"),Object(a.b)("p",null,"What happens if you wrote too many contracts at once? Or your exposure has changed and you need to close your position? This is where the ",Object(a.b)("inlineCode",{parentName:"p"},"ClosePosition")," instruction comes in. This instruction ",Object(a.b)("strong",{parentName:"p"},"requires you to have both the OptionToken and the WriterToken"),". At anypoint (pre or post expiration) if a wallet calls this instruction with the correct token pair preset, it will receive the ",Object(a.b)("inlineCode",{parentName:"p"},"underlying_amount_per_contract"),". The protocol checks and burns both tokens and then transfersthe underlying assets from the pool to the wallet."),Object(a.b)("p",null,"If you sold the OptionToken and would like to close your position, you will have to go to a venue that trades/sells the correct OptionToken and "))}p.isMDXComponent=!0},96:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return b}));var o=n(0),r=n.n(o);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=r.a.createContext({}),p=function(e){var t=r.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return r.a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},d=r.a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),d=o,b=u["".concat(i,".").concat(d)]||u[d]||h[d]||a;return n?r.a.createElement(b,s(s({ref:t},l),{},{components:n})):r.a.createElement(b,s({ref:t},l))}));function b(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"}}]);